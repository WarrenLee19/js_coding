白屏时间：即用户点击一个链接或打开浏览器输入URL地址后，从屏幕空白到显示第一个画面的时间。

### 白屏的过程分析

1. DNS Lookup 

即浏览器从DNS服务器中进行域名查询，浏览器会先对页面进行域名解析，获取到服务器的IP地址后，进而和服务器进行通信。

2. 建立TCP请求连接
 
浏览器和服务端TCP请求建立的过程，是基于TCP/IP，该协议由网络层的IP和传输层的TCP组成。IP是每一台互联网设备在互联网中的唯一地址。TCP通过三次握手建立连接，并提供可靠的数据传输服务。

3. 服务端请求处理响应

在TCP连接建立后，Web服务器接受请求，开始进行处理，同时浏览器端开始等待服务器的处理响应。

4. 客户端下载、解析、渲染显示页面

在服务器返回数据后，客户端浏览器接收数据，进行HTML下载、解析、渲染显示。
* 如果是Gzip包，则先解压为HTML
* 解析HTML的头部代码，下载头部代码中的样式资源文件或脚本资源文件
* 解析HTML代码和样式文件代码，构建HTML的DOM树以及与CSS相关的CSSOM树
* 通过遍历`DOM`树和`CSSDOM`树，浏览器依次计算每个节点的大小、坐标、颜色等样式，构造渲染树
* 根据渲染树完成绘制过程

### 白屏优化
白屏-性能优化
至此，我们已经了解了从浏览器在打开一个链接开始，到屏幕展示的过程-白屏时间的历程，那这对每个环节中发生的事情，我们可以有针对性的进行相关的优化。

1. DNS解析优化
   针对`DNS Lookup`环节，我们可以针对性的进行DNS解析优化。

* DNS缓存优化
* DNS预加载策略（dns-prefetch 和 preconnect）
* 稳定可靠的DNS服务器
2. TCP网络链路优化

针对网络链路的优化，好像除了花钱没有什么更好的方式！

4. 服务端处理优化

服务端的处理优化，是一个非常庞大的话题，会涉及到如Redis缓存、数据库存储优化或是系统内的各种中间件以及Gzip压缩等...

5. 浏览器下载、解析、渲染页面优化

根据浏览器对页面的下载、解析、渲染过程，可以考虑一下的优化处理：

* 尽可能的精简HTML的代码和结构
* 尽可能的优化CSS文件和结构
* 一定要合理地放置JS代码，尽量不要使用内联的JS代码

### 额外的一些优化
1. 骨架屏

在页面资源尚未加载完成以及渲染尚未完成时，需要先给用户的展示页面大致结构。直到资源加载完成以及渲染完成后，使用渲染的页面。
* 首屏：可以在index.html模版中手写骨架屏相关代码。
* 其他页面：可以利用UI提供SVG图
* 作为SPA中路由切换的loading：需自己编写骨架屏，可以使用定制的svg组件去定制骨架屏 - [react-content-loader](https://www.npmjs.com/package/react-content-loader)和[vue-content-loader](https://www.npmjs.com/package/vue-content-loader)。
* 骨架图渲染前不要出现任何网络请求，在此之前 HTML 内容不要超过 4KB。

2. 资源加载优化（图片压缩和新型图片格式）

图片资源的压缩可以去[docsmall](https://docsmall.com/)进行压缩

内部提供了图片资源可以上传到 [前端加速服务](http://fs-finder-dev.yz.test.autohome.com.cn/docs/#/) 或 [前端静态资源服务](http://festatic.yz.test.autohome.com.cn/doc/#/md/useful)内部资源库会自动生成webp格式，可以在项目打包的时候处理图片时加上 format=webp 即可，接口动态图片可采用 [@auto/img-crop](http://npm.corpautohome.com/package/@auto/img-crop)私有包做裁切同时也可通过参数动态支持webp和设置缓存时间




